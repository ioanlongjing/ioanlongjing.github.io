<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>SMB Backdoor</title>

    <!-- Bootstrap Core CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../css/sb-admin.css" rel="stylesheet">

    <!-- Morris Charts CSS -->
    <link href="../css/plugins/morris.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="../font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- highlight.js -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/ir_black.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="../index.html">打鐵鋪</a>
            </div>
 

            <!-- Sidebar Menu Items - These collapse to the responsive navigation menu on small screens -->
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav side-nav">
                    <li>
                        <a href="../index.html"><i class="fa fa-fw fa-dashboard"></i> Index</a>
                    </li>
                    <li>
                        <a href="../AboutMe.html"><i class="fa fa-fw fa-edit"></i> About Me</a>
                    </li>
                    <li>
                        <a href="../Web.html"><i class="fa fa-fw fa-desktop"></i> Web Security</a>
                    </li>
                    <li class="active">
                        <a href="../Reverse.html"><i class="fa fa-fw fa-wrench"></i> Reverse</a>
                    </li>
                    <li  class="active">
                        <a href="../Translate.html"><i class="fa fa-fw fa-file"></i> Translate</a>
                    </li>
                     <li>
                        <a href="../Software.html"><i class="fa fa-fw fa-arrows-v"></i> Software</a>
                    </li>                   
                    <li>
                        <a href="../Note.html"><i class="fa fa-fw fa-table"></i> Note</a>
                </ul>
                    </li>
            </div>
            <!-- /.navbar-collapse -->
        </nav>

        <div id="page-wrapper">

            <div class="container-fluid">

                <!-- Page Heading -->
                <div class="row">
                    <div class="col-lg-12">
                        <ol class="breadcrumb">
                            <li>
                                <i class="fa fa-dashboard"></i>  <a href="index.html">Blog</a>
                            </li>
                            <li class="active">
                                <i class="fa fa-fw fa-file"></i>  <a href="../Reverse.html">Reverse</a>
                            </li>
                            <li class="active">
                               DoublePulsar Initial SMB Backdoor Ring 0 Shellcode Analysis
                            </li>
                        </ol>
                    </div>
                </div>
                <!-- /.row -->
            <!-- contatiner start -->
                <div class="row">
                    <div class="jumbotron">
                    <h2 class="page-header">
                    DoublePulsar Initial SMB Backdoor Ring 0 Shellcode Analysis
                    </h2>
                    <h4>
                        Android Spyware SMSVova found on Google Play Store
                    </h4>
                    </div>
                </div>
                <div class="row">
                <div class="col-lg-3"></div>
                <div class="col-lg-6">
                    <p class="lead">
                    新聞原文轉自 :
                    <a href="https://zerosum0x0.blogspot.tw/2017/04/doublepulsar-initial-smb-backdoor-ring.html#pulsar_step0" target="_blank" rel="noopener noreferrer">zerosum0x0.blogspot.tw</a>  
                    </p>
                </div>
                <div class="col-lg-3"></div>
                </div>
            <!-- Header        -->
            <div class="row">
                <div class="col-lg-2"></div>
                <div class="col-lg-8">
                    <p class="lead">
                    <b>DoublePulsar Initial SMB Backdoor Ring 0 Shellcode Analysis</b>
                    </p> 
                </div>
                <div class="col-lg-2"></div>        

            </div>
            <!-- Header End -->

            <!-- 1        -->
            <div class="row">
                <div class="col-lg-6">
                    <p class="lead">
                    One week ago today, the Shadow Brokers (an unknown hacking entity) leaked the Equation Group's (NSA) FuzzBunch software, an exploitation framework similar to Metasploit. In the framework were several unauthenticated, remote exploits for Windows (such as the exploits codenamed EternalBlue, EternalRomance, and EternalSynergy). Many of the vulnerabilities that are exploited were fixed in MS17-010, perhaps the most critical Windows patch in almost a decade. 
                    </p>  
                </div>
                <div class="col-lg-6">
                    <p class="lead">
                    一個禮拜前的今天 Shadow Brokers (一個不明的駭客組織) 公布 Equation Group (NAS) 所洩漏出，類似 Metasploit 的 exploitation framework。 這個 framework 提供不用驗證可以直接遠端的 Windows exploit (這個 exploit 代號也叫 EternalBlue, EternalRomance, 或 EternalSynergy)。 很多被利用的弱點都會在 MS17-010 被修補，這可能是這十年來最嚴重的漏洞之一。
                    </p>
                </div>
            </div>
            <!-- 1 End -->

            <!-- 2     -->
            <div class="row">
                <div class="col-lg-6">
                    <p class="lead">
                    Side note: You can use my <a href="https://zerosum0x0.blogspot.tw/2017/04/ms17-010-smb-rce-metasploit-scanner.html" target="_blank" rel="noopener noreferrer">MS17-010 Metasploit auxiliary module</a> to scan your networks for systems missing this patch (uncredentialed and non-intrusive). If a missing patch is found, it will also check for an existing DoublePulsar infection.
                    </p>
                </div>
                <div class="col-lg-6">
                    <p class="lead">
                    補充：你可以使用 MS17-010 Metasploit 的 auxiliary module ( <a href="https://zerosum0x0.blogspot.tw/2017/04/ms17-010-smb-rce-metasploit-scanner.html" target="_blank" rel="noopener noreferrer">連結按我</a> ) 來掃描你的網路中有沒有遺漏了這個補丁( 無攻擊性 )。如果沒有找到這 path ， 它也可以確認是否被 DoublePulsar 感染。
                    </p>
                </div>
            </div>
            <!-- 2 End    -->
            <!-- Header 2        -->
            <div class="row">
                <div class="col-lg-6">
                    <p class="lead">
                    <b>Introduction</b>
                    </p>  
                </div>
                <div class="col-lg-6">
                    <p class="lead">
                    <b>簡介</b>
                    </p>
                </div>
            </div>
            <!-- Header 2  End -->
            <!-- 3     -->
            <div class="row">
                <div class="col-lg-6">
                    <p class="lead">
                    For those unfamiliar, DoublePulsar is the primary payload used in SMB and RDP exploits in FuzzBunch. Analysis was performed using the EternalBlue SMBv1/SMBv2 exploit against Windows Server 2008 R2 SP1 x64.
                    </p>
                </div>
                <div class="col-lg-6">
                    <p class="lead">
                    對於那些不熟悉技術的人來說，DoublePulsar 主要的 payload 是用 FuzzBunch 的 SMB 跟 RDP 的 exploit。分析 EternalBlue 的 SMBv1/SMBv2 的 exploit 後發現主要是針對Windows Server 2008 R2 SP1 x64。
                    </p>
                </div>
            </div>
            <!-- 3 End -->
            <!-- 4     -->
            <div class="row">
                <div class="col-lg-6">
                    <p class="lead">
                    The shellcode, in tl;dr fashion, essentially performs the following:
                    </p>
                </div>
                <div class="col-lg-6">
                    <p class="lead">
                    這個 shellcode 簡單來說，可以列成下面這些步驟
                    </p>
                </div>
            </div>
            <!-- 4 End -->
            <!-- stap0     -->
            <div class="row">
                <div class="col-lg-6">
                    <p class="lead">
                    - <a href="#step0">Step 0</a>: Shellcode sorcery to determine if x86 or x64, and branches as such.
                    </p>
                </div>
                <div class="col-lg-6">
                    <p class="lead">
                    - <a href="#step0">Step 0</a>: Shellcode 會先確認是 x86 還是 x64，跟一些其他的項目。
                    </p>
                </div>
            </div>
            <!-- stap0 End -->
            <!-- stap1     -->
            <div class="row">
                <div class="col-lg-6">
                    <p class="lead">
                    - <a href="#step1">Step 1</a>: Locates the <a href="http://wiki.osdev.org/Interrupt_Descriptor_Table" target="_blank" rel="noopener noreferrer">IDT</a> from the <a href="https://en.wikipedia.org/wiki/Processor_Control_Region" target="_blank" rel="noopener noreferrer">KPCR</a>, and traverses backwards from the first interrupt handler to find ntoskrnl.exe base address (DOS MZ header).
                    </p>
                </div>
                <div class="col-lg-6">
                    <p class="lead">
                    - <a href="#step1">Step 1</a>: 從 <a href="http://wiki.osdev.org/Interrupt_Descriptor_Table" target="_blank" rel="noopener noreferrer">IDT</a> 到 <a href="https://en.wikipedia.org/wiki/Processor_Control_Region" target="_blank" rel="noopener noreferrer">KPCR</a>，跟 traverses backwards 到第一個 interrupt handler 去找 ntoskrnl.exe 的 base address ( DOS MZ 的 header )
                    </p>
                </div>
            </div>
            <!-- stap1 End -->
            <!-- stap1     -->
            <div class="row">
                <div class="col-lg-6">
                    <p class="lead">
                    - <a href="#step2">Step 2</a>: Reads ntoskrnl.exe's exports directory, and uses hashes (similar to usermode shellcode) to find ExAllocPool/ExFreePool/ZwQuerySystemInformation functions.
                    </p>
                </div>
                <div class="col-lg-6">
                    <p class="lead">
                    - <a href="#step2">Step 2</a>: 讀取 ntoskrn1.exe 所在得目錄，跟使用 hashes (類似 usermode shellcode) 來找 ExAllocPool/ExFreePool/ZwQuerySystemInformation 這些 function 。
                    </p>
                </div>
            </div>
            <!-- stap1 End -->


            <!-- /.container-fluid -->

        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- jQuery -->
    <script src="../js/jquery.js"></script>


    <!-- Bootstrap Core JavaScript -->
    <script src="../js/bootstrap.min.js"></script>

    <!-- Morris Charts JavaScript -->
    <script src="../js/plugins/morris/raphael.min.js"></script>
    <script src="../js/plugins/morris/morris.min.js"></script>
    <script src="../js/plugins/morris/morris-data.js"></script>

</body>

</html>
